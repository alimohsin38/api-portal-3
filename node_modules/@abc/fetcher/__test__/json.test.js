import fetcher from '../src/fetcher';
import helper from './__mocks__/mockhelper';

describe('Custom JSON Fetch Promises', () => {

    beforeEach(() => {
        global.fetch = jest.fn().mockImplementationOnce((url, data) =>
            Promise.resolve(helper.mockJsonResponse(url, data, '{"planet":"express"}')));
    });

    it('Should get the JSON Promise from GET', () => {

        return fetcher.get(helper.url)
            .json(json => {
                expect(typeof json).toBe('object');
                expect(json.planet).toBe('express');
            });
    });

    it('Should get the JSON Promise from POST', () => {

        return fetcher.post(helper.url, helper.dummyData).json(json => {
            expect(typeof json).toBe('object');
            expect(json.fry).toBe('phillip');
        });
    });

    it('Should get the JSON Promise from PUT', () => {

        return fetcher.put(helper.url, helper.dummyData)
            .json(json => {
                expect(typeof json).toBe('object');
                expect(json.fry).toBe('phillip');
            });
    });


    it('Should get the JSON Promise from DEL', () => {

        return fetcher.del(helper.url, helper.dummyData)
            .json(json => {
                expect(typeof json).toBe('object');
                expect(json.fry).toBe('phillip');
            });
    });
});