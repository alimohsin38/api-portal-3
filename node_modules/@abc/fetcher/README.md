# Fetcher.js
<img src="http://i.imgur.com/X9840mX.png" width="250px" />

Universal [Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API) wrapper for common use cases and predefined variables.

Fetcher.js will try to stay as close to the Fetch API as possible. It is a very simple library that tries to make fetch slightly easier to use, by separating out the body data from the request headers and adds default request header options that will be used in nearly every fetch request.

* [HTTP Requests](#http-requests)
* [Error Handling](#error-handling) - catching HTTP response errors
* [Shortcut Promises](#shortcut-promises) - easy handling json/text reponses
* [Set Tokens](#set-tokens)

## Basic Use

```JavaScript
import fetcher from '@abc/fetcher'

fetcher.get('https://abcfinancial.com/api/someapi').json(json => console.log(json))
```

##### Optional Parameters

You are able to send in parameters just like the vainalla Fetch API, such as below:

```JavaScript
fetcher.post('https://abcfinancial.com/api/someapi', {mars: 'Amy Wong'}, {
    method: 'PUT',
    headers: {
        'Authorization': 'YWxsIGdsb3J5IHRvIHRoZSBoeXBub3RvYWQ='
    },
    body: '{fullname: "Bender Bending Rodriquez Sr."}'
})
```

This will instead send the method as a PUT with overwritten data. **DO NOT DO THIS**, but it demonstrates how you can use the option field to give you more control of the Fetch API.

## HTTP Requests

#### Parameters
* url - API URL to Fetch
* data - `body` data of the request (the paramters to be sent)
* opts - All other Fetch API options defined in the original spec. Any option can be overriden here, even `body`.

The requests mirror the standard [HTTP request](https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html) and all follow the same pattern:

##### GET

```JavaScript
fetcher.get(url, opts = {})
```

##### POST

```JavaScript
fetcher.post(url, data, opts = {})
```

##### PUT

```JavaScript
fetcher.put(url, data, opts = {})
```

##### DEL

```JavaScript
fetcher.del(url, data, opts = {})
```

##### HEAD

```JavaScript
fetcher.head(url, data, opts = {})
```

## Error Handling

In the vanilla Fetch API, errors are not thrown when the server responds with an errored response such as 404, 500, etc.
These are still valid HTTP responses and the Fetch call has not erred out, the server has.
Fetcher **will** throw an error when it receives a bad response, so that the developer can catch these and handle these
gracefully.

If you make a request and receive a 404, then it can be handled this way:

```JavaScript
fetcher.get(url).then(res => {
    // do stuff
})
.catch(err => {
    console.error(err.response.status, err.response.statusText)
})
```

An `errorCallback` can be set to allow the developer to do special error handling if desired. From the error callback,
you can `return` to just ignore errors of a certain type or `throw` the error to fire your `catch` method. You can also
do any other processing you need to do in this `errorCallback`.

```javascript
const onError = () => {
    // do app specific clean ups
}
fetcher.setErrorCallback(onError)
```

## Shortcut Promises
Fetcher's goal is to make using Fetch easier. It tries to abstract away repetious code. The vanilla Fetch API is very explicit and common requests sometimes require special headers and handling multiple promise steps. With Fetcher, you skip that part. These are created as method chains and can be used after the [basic requests](#available-requests) defined above.

### JSON

Use:

```JavaScript
fetcher.get(url).json(json => {
   // a json object is returned here
   console.log(json)
})
```

Default Header:

```JavaScript
headers: {
    'Accept': 'application/json',
    'Content-Type': 'application/json'
}
```

### Text

Use:

```JavaScript
fetcher.get(url).text(text => {
    // a json object is returned here
    console.log(text)
})
```

Default Header:

```JavaScript
headers: {
    'Accept': 'text/*'
}
```

### No Response

This is a semantic tag to fire the fetch call, but when the developer doesn't care about the data coming back or even if an error occurred. Used primary for situations like logout. Uses default headers.

Use:

```JavaScript
fetcher.get(url).noResponse()
```

## Set Tokens

There are 2 tokens you can let the class maintain. `X-CSRF-TOKEN` and `Authorization`. You can store these by simply setting them in your app initialization.

    fetcher.setCsrf(token);
    fethcer.setAuth(someOtherToken);

These will be sent on their respective header attributes described above.

## Set Location / Organization IDs

Fetcher can maintain your Location and Organization IDs for you, which can be retrieved through the `ABCFS-LOCATION-ID` and `ABCFS-ORGANIZATION-ID` headers respectively.

    fetcher.setLocation(locationId) // sets ABCFS-LOCATION-ID header
    fetcher.setOrganization(orgId)  // sets ABCFS-ORGANIZATION-ID header

## Clear Location / Organization IDs

    fetcher.clearLocation() // clear ABCFS-LOCATION-ID header
    fetcher.clearOrganization()  // clears ABCFS-ORGANIZATION-ID header
